<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>路线详情</title>
    <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="css/common.css" rel="stylesheet" type="text/css">
    <link href="css/route-detail.css" rel="stylesheet" type="text/css">
    <script src="js/getParameter.js"></script>
</head>

<body>
<!--引入头部-->
<div id="header"></div>
<!-- 详情 start -->
<div class="wrap">
    <!--<div class="bread_box">
        <a href="/">首页</a>
        <span> &gt;</span>
        <a href="#">国内游</a><span> &gt;</span>
        <a href="#">全国-曼谷6-7天自由行 泰国出境旅游 特价往返机票自由行二次确认</a>
    </div>-->
    <div class="prosum_box">
        <dl class="prosum_left">
            <dt id="big_img">
                <!--<img alt="" class="big_img"
                     src="http://www.jinmalvyou.com/Public/uploads/goods_img/img_size4/201703/m49788843d72171643297ccc033d9288ee.jpg">-->
            </dt>
            <dd id="dd">
                <!--<a class="up_img up_img_disable"></a>
                <a title="" class="little_img"
                   data-bigpic="http://www.jinmalvyou.com/Public/uploads/goods_img/img_size4/201703/m40920d0669855e745d97f9ad1df966ebb.jpg">
                    <img src="http://www.jinmalvyou.com/Public/uploads/goods_img/img_size2/201703/m20920d0669855e745d97f9ad1df966ebb.jpg">
                </a>
                <a title="" class="little_img cur_img"
                   data-bigpic="http://www.jinmalvyou.com/Public/uploads/goods_img/img_size4/201703/m49788843d72171643297ccc033d9288ee.jpg">
                    <img src="http://www.jinmalvyou.com/Public/uploads/goods_img/img_size2/201703/m29788843d72171643297ccc033d9288ee.jpg">
                </a>
                <a title="" class="little_img"
                   data-bigpic="http://www.jinmalvyou.com/Public/uploads/goods_img/img_size4/201703/m4531a8dbceefa2c44e6d0e35627cd2689.jpg">
                    <img src="http://www.jinmalvyou.com/Public/uploads/goods_img/img_size2/201703/m2531a8dbceefa2c44e6d0e35627cd2689.jpg">
                </a>
                <a title="" class="little_img"
                   data-bigpic="http://www.jinmalvyou.com/Public/uploads/goods_img/img_size4/201703/m46d8cb900e9f6c0a762aca19eae40c00c.jpg">
                    <img src="http://www.jinmalvyou.com/Public/uploads/goods_img/img_size2/201703/m26d8cb900e9f6c0a762aca19eae40c00c.jpg">
                </a>
                <a title="" class="little_img"
                   data-bigpic="http://www.jinmalvyou.com/Public/uploads/goods_img/img_size4/201703/m45ea00f6eba562a767b5095bbf8cffe07.jpg"
                   style="display:none;">
                    <img src="http://www.jinmalvyou.com/Public/uploads/goods_img/img_size2/201703/m25ea00f6eba562a767b5095bbf8cffe07.jpg">
                </a>
                <a title="" class="little_img"
                   data-bigpic="http://www.jinmalvyou.com/Public/uploads/goods_img/img_size4/201703/m4265ec488cd1bc7ce749bc8c9b34b87bc.jpg"
                   style="display:none;">
                    <img src="http://www.jinmalvyou.com/Public/uploads/goods_img/img_size2/201703/m2265ec488cd1bc7ce749bc8c9b34b87bc.jpg">
                </a>
                <a title="" class="little_img"
                   data-bigpic="http://www.jinmalvyou.com/Public/uploads/goods_img/img_size4/201703/m4e7e964909d7dd1a9f6e5494d4dc0c847.jpg"
                   style="display:none;">
                    <img src="http://www.jinmalvyou.com/Public/uploads/goods_img/img_size2/201703/m2e7e964909d7dd1a9f6e5494d4dc0c847.jpg">
                </a>
                <a title="" class="little_img"
                   data-bigpic="http://www.jinmalvyou.com/Public/uploads/goods_img/img_size4/201703/m467db00e1b76718fab0fe8b96e10f4d35.jpg"
                   style="display:none;">
                    <img src="http://www.jinmalvyou.com/Public/uploads/goods_img/img_size2/201703/m267db00e1b76718fab0fe8b96e10f4d35.jpg">
                </a>
                <a title="" class="little_img"
                   data-bigpic="http://www.jinmalvyou.com/Public/uploads/goods_img/img_size4/201703/m487bbbc6e43eba6aa6a36cc1a182f7a20.jpg"
                   style="display:none;">
                    <img src="http://www.jinmalvyou.com/Public/uploads/goods_img/img_size2/201703/m287bbbc6e43eba6aa6a36cc1a182f7a20.jpg">
                </a>
                <a class="down_img down_img_disable" style="margin-bottom: 0;"></a>-->
            </dd>
        </dl>
        <div class="prosum_right">
            <p class="pros_title" id="tname"></p>
            <p class="hot" id="testIntroduce"></p>
            <div class="pros_other">
                <p><span id="source_sp"> </span></p>
            </div>
            <div class="pros_price">
                <p class="price"><strong id="price"> </strong><span>起</span></p>
                <p class="collect">
                    <a class="btn" id="favorite" onclick="addFavorite()"><i class="glyphicon glyphicon-heart-empty"></i>点击收藏</a>

                    <!--<a class="btn already" disabled="disabled"><i class="glyphicon glyphicon-heart-empty"></i>点击收藏</a>-->
                    <span id="favoriteCount"></span>
                </p>
                <p class="price">平均评分：<strong id="totalScore"> </strong></p>

            </div>

            <div class="ll j a_stars">


                评价:
                <span id="rating"> <span
                        data-hollow="https://img3.doubanio.com/f/shire/2520c01967207a1735171056ec588c8c1257e5f8/pics/rating_icons/images/start.svg"
                        data-hollow-2x="https://img3.doubanio.com/f/shire/95cc2fa733221bb8edd28ad56a7145a5ad33383e/pics/rating_icons/star_hollow_hover@2x.png"
                        data-solid="https://img3.doubanio.com/f/shire/5a2327c04c0c231bced131ddf3f4467eb80c1c86/pics/rating_icons/star_onmouseover.png"
                        data-solid-2x="https://img3.doubanio.com/f/shire/7258904022439076d57303c3b06ad195bf1dc41a/pics/rating_icons/star_onmouseover@2x.png"
                        id="stars">

                <a class="j a_show_login"
                   href="#"
                   name="pbtn-34876223-1" tppabs="https://www.douban.com/register?reason=rate">

                <img height="16"
                     onclick="addScore(2)"

                     id="star1"
                     src="images/start.svg"
                     tppabs="https://img3.doubanio.com/f/shire/2520c01967207a1735171056ec588c8c1257e5f8/pics/rating_icons/images/start.svg"
                     width="16"/>
                </a>2分

                <a class="j a_show_login"
                   name="pbtn-34876223-2" tppabs="https://www.douban.com/register?reason=rate">
                <img height="16"
                     onclick="addScore(4)"
                     id="star2"
                     src="images/start.svg"
                     tppabs="https://img3.doubanio.com/f/shire/2520c01967207a1735171056ec588c8c1257e5f8/pics/rating_icons/images/start.svg"
                     width="16"/>
                </a>4分

                <a class="j a_show_login"
                   name="pbtn-34876223-3" tppabs="https://www.douban.com/register?reason=rate">
                <img height="16"
                     onclick="addScore(6)"
                     id="star3"
                     src="images/start.svg"
                     tppabs="https://img3.doubanio.com/f/shire/2520c01967207a1735171056ec588c8c1257e5f8/pics/rating_icons/images/start.svg"
                     width="16"/></a>6分

                <a class="j a_show_login"
                   name="pbtn-34876223-4" tppabs="https://www.douban.com/register?reason=rate">
                 <img height="16"
                      onclick="addScore(8)"
                      id="star4"
                      src="images/start.svg"
                      tppabs="https://img3.doubanio.com/f/shire/2520c01967207a1735171056ec588c8c1257e5f8/pics/rating_icons/images/start.svg"
                      width="16"/></a>8分

                <a class="j a_show_login"
                   name="pbtn-34876223-5" tppabs="https://www.douban.com/register?reason=rate">
                    <img height="16"
                         onclick="addScore(10)"
                         id="star5"
                         src="images/start.svg"
                         tppabs="https://img3.doubanio.com/f/shire/2520c01967207a1735171056ec588c8c1257e5f8/pics/rating_icons/images/start.svg"
                         width="16"/>
                    <!--<div>
                        <img height="16"
                             src="images/start.svg"
                             width="16"/>
                        <img height="16"
                             src="images/start.svg"
                             width="16"/>

                    </div>-->

                </a>10分

                </span><span class="pl" id="rateword"></span>
                <input id="n_rating" type="hidden" value=""/>
                </span>

            </div>


        </div>
    </div>
    <div class="you_need_konw">
        <span>评论</span>
        <!--引入评论:在include.js文件中-->
        <div class="notice" id="common"></div>
    </div>
</div>
<!-- 详情 end -->


<!--引入头部-->
<div id="footer"></div>

<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="js/jquery-3.3.1.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="js/bootstrap.min.js"></script>
<!--导入布局js，共享header和footer-->
<script src="js/include.js" type="text/javascript"></script>


<script>
    $(function () {
        var tid = getParameter("tid");
        $.get("testTol/findOne", {tid: tid}, function (testTol) {
            $("#tname").html(testTol.tname);
            $("#testTolIntro").html(testTol.testTolIntroduce);
            $("#price").html("¥" + testTol.price);
            $("#favoriteCount").html("已收藏" + testTol.count + "次");
            $("#source_sp").html('<a href="' + testTol.source + '">点击查看使用详情</a>');
            $("#thread_subject").html(testTol.tname);
            $("#big_img").html('<img alt="" class="big_img"\n' +
                '                     src="' + testTol.timage + '">');


            var ddstr = '<a class="up_img up_img_disable"></a>';
            for (var i = 0; i < testTol.testTolImgList.length; i++) {
                var astr = "";
                if (i >= 4) {
                    astr = '<a title="" class="little_img" data-bigpic="' + testTol.testTolImgList[i].bigPic + '" style="display:none;">\n' +
                        '                    <img src="' + testTol.testTolImgList[i].smallPic + '">\n' +
                        '                    </a>';
                } else {
                    astr = '<a title="" class="little_img" data-bigpic="' + testTol.testTolImgList[i].bigPic + '">\n' +
                        '                    <img src="' + testTol.testTolImgList[i].smallPic + '">\n' +
                        '                    </a>';

                }
                ddstr += astr;
            }
            ddstr += '<a class="down_img down_img_disable" style="margin-bottom: 0;"></a>';
            /*$("#dd").html(ddstr);*/
        })
    })
    //判断是否收藏
    $(function () {
        var tid = getParameter("tid");
        $.get("testTol/isFavorite", {tid: tid}, function (flag) {
            if (flag) {
                //添加样式
                $("#favorite").addClass("already");
                $("#favorite").attr("disabled", "disabled");//属性都要用“”, prop设置固有属性
                //已经收藏。删除按钮点击事件
                $("#favorite").removeAttr("onclick");
            }
        })
    })

    //查询得分
    $(function () {
        var tid = getParameter("tid");
        $.get("score/findTotalScoreByTid", {tid: tid}, function (score) {
            $("#totalScore").html(score+"分");
        })
    })

    //收藏+设置发表评论
    function addFavorite() {
        var tid = getParameter("tid");
        $.get("user/findOne", {}, function (user) {
            if (user != null) {
                $.get("testTol/addFavorite", {tid: tid}, function () {
                    location.reload();
                });
                /*
                                $("#fastposteditor").attr("display", "none");//属性都要用“”, prop设置固有属性*/

            } else {
                alert("请先登录！");
                location.href = "http://localhost/ones/login.html";
            }

        })
    }

    $(function () {
        //设置评论
        $.get("user/findOne", {}, function (data) {
            if (data != null) {
                $("#claim_div").css("display", "none");
            } else {
                $("#seccheck_fastpost").css("display", "none");
                $("#common_div").css("display", "none");
            }
        });

    })

    //添加评分
    function addScore(score) {
        var tid = getParameter("tid");

        $.get("user/findOne", {}, function (user) {
            if (user != null) {
                $.get("score/addScore", {uid:user.uid, tid:tid, score:score}, function (flag) {
                    if (flag){
                        alert("评论成功！");
                    }else {
                        alert("您已经评过分了！");
                    }
                });

            } else {
                alert("请先登录,再评论！");
                location.href = "http://localhost/ones/login.html";
            }

        })


    }











</script>


</body>
</html>